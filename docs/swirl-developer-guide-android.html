<!DOCTYPE html>
<html lang="en" class=" is-copy-enabled emoji-size-boost is-u2f-enabled">
	<head prefix="og: http://ogp.me/ns# fb: http://ogp.me/ns/fb# object: http://ogp.me/ns/object# article: http://ogp.me/ns/article# profile: http://ogp.me/ns/profile#">
		<meta charset='utf-8'>
		<link href="/swirl-sdk-android/markdown.css" media="all" rel="stylesheet" />
		<title>Swirl Networks</title>
	</head>

	<body class="logged-in env-production macintosh vis-private page-blob">
		<div class="container new-discussion-timeline experiment-repo-nav">
			<div class="repository-content">
				<div class="file">
					<div class="file-header">&nbsp;</div>
					<div id="readme" class="readme blob instapaper_body">
						<article class="markdown-body entry-content" itemprop="text">
<!-- BEGIN-CONTENT -->
<h1>
<a id="user-content-swirl-proximity-developer-guide" class="anchor" name="swirl-proximity-developer-guide" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Swirl Proximity Developer Guide</h1>
<p>The Swirl platform is designed as a complete proximity platform detecting a variety of proximity signals like geofence, wifi and beacons and managing presence tracking, notification and content delivery.  The Swirl SDK is a component of this system which enables signal detection on mobile devices.</p>
<h2>
<a id="user-content-contents" class="anchor" name="contents" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Contents</h2>
<ul>
<li>
<a href="#understanding-swirl">Understanding Swirl</a>
<ul>
<li><a href="#concepts-and-objects">Concepts and Objects</a></li>
</ul>
</li>
<li>
<a href="#technical-overview">Technical Overview</a>
<ul>
<li><a href="#architecture">Architechture</a></li>
</ul>
</li>
<li>
<a href="#integration">Integration</a>
<ul>
<li><a href="#get-application-key">Get Application Key</a></li>
<li><a href="#verify-tools-and-targets">Verify Tools and Targets</a></li>
<li><a href="#add-library-to-your-application">Add Library to your Application</a></li>
<li><a href="#understanding-and-modifying-androidmanifestxml">Understanding and Modifying AndroidManifest.xml</a></li>
<li><a href="#make-code-changes">Make Code Changes</a></li>
<li><a href="#using-nearby-with-swirl">Using Nearby with Swirl</a></li>
</ul>
</li>
</ul>
<h2>
<a id="user-content-understanding-swirl" class="anchor" name="understanding-swirl" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Understanding Swirl</h2>
<p><a href="./images/sdk3-architecture-overview.png" target="_blank"><img src="./images/sdk3-architecture-overview.png" alt="" style="max-width:100%;"></a></p>
<h3>
<a id="user-content-concepts-and-objects" class="anchor" name="concepts-and-objects" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Concepts and Objects</h3>
<p>The Swirl platform and SDK use some key objects that are useful to define here.</p>
<p><strong>Location</strong>: a physical street, city, state address - typically a brick-and-mortar store or venue. Locations are created and managed centrally in the Console and form the core building blocks of the platform.</p>
<p><strong>Placement</strong>: a logical and business-friendly name given to a specific area inside a location.  For example - cosmetics, electronics department, checkout, neighborhood, parking lot, etc. Placements define the desired level of audience targeting and analytics/data collection marketers wish to achieve based on their defined marketing objectives.</p>
<p><strong>BeaconAdvertisement</strong>: an object which represents a single advertisement of a BLE beacon.  It contains a normalized identifier, an RSSI (signal strength) and a timestamp.  It can also contain extra information for protocols (like Eddystone) that broadcast such additional information.</p>
<p><strong>Beacon</strong>:  an object which represents a BLE beacon.  It aggregates a stream of <strong>BeaconAdvertisements</strong> into a coherent object along with any server-side attributes assigned to the beacon, provided the current application has access rights to the signal.  Server-side attributes include <strong>Location</strong>, <strong>Placement</strong>, and any labels and custom-attributes assigned through the platform.</p>
<p><strong>Region</strong>: an object representing a Geofence.  It has a GPS coordinate and a radius, or a set of points which represent a non-circular border.  Like a beacon, it also aggregates server side information like <strong>Location</strong>, <strong>Placement</strong> and any labels and custom-attributes assgned through the platform.</p>
<p><strong>WifiInfo</strong>: an object that represents the current access point the mobile device is connected to.  It contains the BSSID, the SSID and an RSSI (if present).  Like other objects in the system, it can be associated with server-side objects like <strong>Location</strong>, <strong>Placement</strong>, and custom attributes.</p>
<p><strong>Visit</strong>: an object which represents a higher-level of presence event.  All lower-level (Region, Beacon, Wifi) presence events are aggregated into a logical Visit event.  Visit objects contain <strong>Location</strong>, and <strong>Placement</strong> information as well as tracking location and placement dwell time and total elapsed time.</p>
<p><strong>Content</strong>: an object which represents targeted content selected by the platform in response to a presence event trigger (entry, dwell threshold exceeded, etc).  Content is generally a bundle containing metadata to create a notification and either a deep-link URL, an HTML creative URL or a JSON bag of custom attributes.</p>
<h3>
<a id="user-content-user-privacy-and-permissions" class="anchor" name="user-privacy-and-permissions" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>User Privacy and Permissions</h3>
<p>Earier versions of the Swirl SDK enforced a strict user opt-in policy which often complicated the host application's own attempts at user on-boarding and opt-in flows.  As a result, the current SDK has eliminated all notions of user status and state from the SDK and relies completely on the host-application to follow best practices in this area.  This SDK tracks location and should not be used unless the user has explicitly granted the application such rights.  For the most part, the OS helps enforce this best practice, but it is not universally the case and what the OS enforces varies by platform.  On Android, location permissions must be granted in order to use BLE beacons, on iOS this is not the case.  The host application is responsible for requesting the appropriate permissions and the SDK will try to run within those constraints to the best of its ability.</p>
<h2>
<a id="user-content-technical-overview" class="anchor" name="technical-overview" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Technical Overview</h2>
<h3>
<a id="user-content-architecture" class="anchor" name="architecture" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Architecture</h3>
<p>The architecture of the Swirl SDK is similar on all platforms.  The Swirl object acts as a shell which establishes a working queue or thread, a common message bus and loads various managers into that enviorment.  The SDK glues together signal detection code that interacts with OS apis for detecting beacon, wifi and geofence signals with code that interacts with the swirl REST APIs to determine logical metadata like location, placement and other custom metadata.  In addition, the SDK tracks and accumulates dwell and can manage interaction with the platform to request and display targeted content.</p>
<p><a href="./images/sdk3-android-architecture.png" target="_blank"><img src="./images/sdk3-android-architecture.png" alt="" style="max-width:100%;"></a></p>
<h4>
<a id="user-content-key-components" class="anchor" name="key-components" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Key components</h4>
<p>The following is a list of the key components of the SDK and a brief description of each.  Most of these components are internal to the SDK but their description here is provided to help understand the operaiton of the SDK.  It is important to note that developers can extend the operation of the Swirl SDK by adding their own managers to the internal message bus and participate fully in its operation.</p>
<ul>
<li>
<strong>Swirl</strong>:  The external wrapper for the API.  All public interfaces live here.  The ability to add delegates/listeners to the bus, post messages to components, set options, start and stop the SDK.  Establishes the private thread/queue, the message bus and loads all managers.</li>
<li>
<strong>EventBus</strong>:  The internal message bus.  Implementation varies by platform, but ensure that components can message each other in a way that ensures thread safety.  Managers can subscribe to messages, post messages or both.  On Android the implementation is a lightweight @Subscribe message delivery mechanism that ensures messages are dispatch using the correct Executor.</li>
<li>
<strong>BluetoothScanner</strong>:  A component which interact with the BluetoothManager apis for bluetooth or beacon detection and which publish normalized <strong>BeaconAdvertisement</strong> objects on to the bus.</li>
<li>
<strong>BeaconManager</strong>:  A component which subscribes to <strong>BeaconAdvertisement</strong> messages and aggregates those advertisements into a <strong>Beacon</strong> object.  It uses the API to resolve beacons (or not) and to fetch assoicated logical location and placement information and metadata.  It monitors beacons for proximity and manages enter, exit and closest detection.  It posts BeaconEnter, BeaconExit, BeaconDwell, BeacionNearest messages onto the bus.</li>
<li>
<strong>RegionManager</strong>:  A component which manages a working set of <strong>Region</strong> objects (retreived using the API) that are 'near' the users location.  These regions represent both geofences and 'control' regions.  Geofences have logical location, placement and other metadata associated.  Control regions are used internally by the SDK to control other signal detection, like when to start and stop scanning for beacons or what iBeacon UUIDs are nearby.  This component either starts its own os specific location manager or depends upon the host app to post location information onto the bus.  It generates RegionEnter/RegionExit events onto the bus.</li>
<li>
<strong>WifiManager</strong>: A component which integrates with the OS interfaces for detecting current connected wifi information and tracks changes to the connection state.  It coordinates through the API with the Swirl platform to get assoicated logical location informationa and associated metadata. It posts WifiEnter, WifiExit, WifiDwell events onto the message bus and creates <strong>WifiInfo</strong> objects.</li>
<li>
<strong>NearbyManager</strong>:  A component which integrates the Nearby APIs to scan for beacons registered using the google beacon platform. The Nearby APIs return messages attached to beacons with many types.  The NearbyManager automatically handles beacon attachments, processing some internally and returning others to the application.</li>
<li>
<strong>VisitManager</strong>:  A component which consumes the various Enter/Exit/Dwell events from the signal detectors and tracks enter and exit times, accumulates dwell and elapsed times by location and placement, and generates logical <strong>Visit</strong> objects and events for BeginVisit,DwellVisit, and EndVisit.</li>
<li>
<strong>ContentManager</strong>: A component which consumes <strong>Visit</strong> objects and events and requests content through the API.  If content is returned, then depending upon application state and SDK settings, it is responsible for displaying OS notifications and launching a content view or an application deep link.  This component is not part of the default set of managers that are loaded and users who want content services will add this object or a subclass of this object to the bus at startup.</li>
<li>
<strong>API</strong>:  A singleton which wraps the REST API to the Swirl platform.  All communications with the server are secure using https and all APIs must be authenticated using the API Key assigned through the Swirl platform.</li>
<li>
<strong>Settings</strong>: A singleton which provides property value and object storage in a local, encrypted store.  All constants in the system are reflected through this object with local, server, and default values.  Values can be pushed from the server to change the behavior of the system at runtime.</li>
</ul>
<h2>
<a id="user-content-integration" class="anchor" name="integration" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Integration</h2>
<h3>
<a id="user-content-get-application-key" class="anchor" name="get-application-key" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Get Application Key</h3>
<p>Log in to the Swirl console using supported browser (Chrome or Safari) and using credentials you have received from your Swirl representative or Swirl administrator.</p>
<ol>
<li>Navigate to the Apps tab in the portal</li>
<li>Create a new application.</li>
<li>This process will generate an Application Key. This value will be needed to passed to the SDK at start.</li>
</ol>
<h3>
<a id="user-content-verify-tools-and-targets" class="anchor" name="verify-tools-and-targets" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Verify Tools and Targets</h3>
<p>The Swirl SDK is compatible with Android versions 5.0 (API level 21) and above.<br>
The Swirl SDK has the following dependecies:
'com.google.android.gms:play-services-auth:9+'
'com.google.android.gms:play-services-nearby:9+'</p>
<h3>
<a id="user-content-add-library-to-your-application" class="anchor" name="add-library-to-your-application" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Add Library to your Application</h3>
<h4>
<a id="user-content-adding-the-library-manually" class="anchor" name="adding-the-library-manually" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Adding the Library Manually</h4>
<ol>
<li>Copy the Swirl AAR into <strong>&lt;Project&gt;/app/libs</strong>
</li>
</ol>
<p><a href="./images/sdk3-import-gradle-01.png" target="_blank"><img src="./images/sdk3-import-gradle-01.png" alt="" style="max-width:100%;"></a></p>
<ol start="2">
<li>
<p>Edit <code>build.gradle (Module: app)</code></p>
</li>
<li>
<p>Add a repository for the libs directory</p>
<div class="highlight highlight-source-groovy-gradle"><pre><span class="pl-en">repositories</span> {
    flatDir {
        dirs <span class="pl-s"><span class="pl-pds">'</span>libs<span class="pl-pds">'</span></span>
    }
}</pre></div>
</li>
<li>
<p>Add a line in <code>dependencies</code> to compile the Swirl AAR</p>
<div class="highlight highlight-source-groovy-gradle"><pre><span class="pl-en">dependencies</span> {
    compile(<span class="pl-c1">name</span>: <span class="pl-s"><span class="pl-pds">'</span>swirl-release<span class="pl-pds">'</span></span>, <span class="pl-c1">ext</span>: <span class="pl-s"><span class="pl-pds">'</span>aar<span class="pl-pds">'</span></span>)
    <span class="pl-k">..</span>.
}</pre></div>
</li>
<li>
<p>Click <strong>"Sync Now"</strong> in the upper right to apply the changes</p>
</li>
</ol>
<h4>
<a id="user-content-adding-the-library-using-maven" class="anchor" name="adding-the-library-using-maven" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Adding the Library using Maven</h4>
<ol>
<li><em>Coming soon</em></li>
</ol>
<h3>
<a id="user-content-understanding-and-modifying-androidmanifestxml" class="anchor" name="understanding-and-modifying-androidmanifestxml" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Understanding and Modifying AndroidManifest.xml</h3>
<p>Curently, most of the manifest changes are not included in the libraries AndroidManifest.xml and you are required to add the necessary permissions and registrations to the application AndroidManifest.xml.  This is currently done on purpose to give more control to the application developer with regards to what features to enable, etc.</p>
<h4>
<a id="user-content-permissions" class="anchor" name="permissions" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Permissions</h4>
<p>There are static and dynamic permissions required to enable the Swirl library to function properly.  Below is the basic set of static permissions required to use Swirl.  Certain permissions in here are optional on the whole, but required for certain features.  For example, ACCESS_WIFI_STATE is required for using Wifi access points as signals for the platform.</p>
<p>There are additional changes that are required for Android 6.0 but those need to be made in code and are mentioned below.</p>
<div class="highlight highlight-text-xml"><pre> &lt;<span class="pl-ent">uses-permission</span> <span class="pl-e">android</span><span class="pl-e">:</span><span class="pl-e">name</span>=<span class="pl-s"><span class="pl-pds">"</span>android.permission.INTERNET<span class="pl-pds">"</span></span> /&gt;                  <span class="pl-c"><span class="pl-c">&lt;!--</span> Required for internet <span class="pl-c">--&gt;</span></span>
 &lt;<span class="pl-ent">uses-permission</span> <span class="pl-e">android</span><span class="pl-e">:</span><span class="pl-e">name</span>=<span class="pl-s"><span class="pl-pds">"</span>android.permission.ACCESS_NETWORK_STATE<span class="pl-pds">"</span></span> /&gt;      <span class="pl-c"><span class="pl-c">&lt;!--</span> Required to check connectivity <span class="pl-c">--&gt;</span></span>
 &lt;<span class="pl-ent">uses-permission</span> <span class="pl-e">android</span><span class="pl-e">:</span><span class="pl-e">name</span>=<span class="pl-s"><span class="pl-pds">"</span>android.permission.ACCESS_WIFI_STATE<span class="pl-pds">"</span></span>/&gt;
 &lt;<span class="pl-ent">uses-permission</span> <span class="pl-e">android</span><span class="pl-e">:</span><span class="pl-e">name</span>=<span class="pl-s"><span class="pl-pds">"</span>android.permission.BLUETOOTH<span class="pl-pds">"</span></span>/&gt;                  <span class="pl-c"><span class="pl-c">&lt;!--</span> Required for BLE <span class="pl-c">--&gt;</span></span>
 &lt;<span class="pl-ent">uses-permission</span> <span class="pl-e">android</span><span class="pl-e">:</span><span class="pl-e">name</span>=<span class="pl-s"><span class="pl-pds">"</span>android.permission.BLUETOOTH_ADMIN<span class="pl-pds">"</span></span>/&gt;            <span class="pl-c"><span class="pl-c">&lt;!--</span> Required for BLE <span class="pl-c">--&gt;</span></span>
 &lt;<span class="pl-ent">uses-permission</span> <span class="pl-e">android</span><span class="pl-e">:</span><span class="pl-e">name</span>=<span class="pl-s"><span class="pl-pds">"</span>android.permission.RECEIVE_BOOT_COMPLETED<span class="pl-pds">"</span></span>/&gt;     <span class="pl-c"><span class="pl-c">&lt;!--</span> Required to start swirl on boot <span class="pl-c">--&gt;</span></span>
 &lt;<span class="pl-ent">uses-permission</span> <span class="pl-e">android</span><span class="pl-e">:</span><span class="pl-e">name</span>=<span class="pl-s"><span class="pl-pds">"</span>android.permission.ACCESS_COARSE_LOCATION<span class="pl-pds">"</span></span> /&gt;    <span class="pl-c"><span class="pl-c">&lt;!--</span> Required for location <span class="pl-c">--&gt;</span></span>
 &lt;<span class="pl-ent">uses-permission</span> <span class="pl-e">android</span><span class="pl-e">:</span><span class="pl-e">name</span>=<span class="pl-s"><span class="pl-pds">"</span>android.permission.ACCESS_FINE_LOCATION<span class="pl-pds">"</span></span> /&gt;      <span class="pl-c"><span class="pl-c">&lt;!--</span> Optional for occasional fine-location <span class="pl-c">--&gt;</span></span></pre></div>
<h4>
<a id="user-content-startup-options" class="anchor" name="startup-options" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Startup Options</h4>
<p>There are several ways to pass startup options to the Swirl library.  You can do so when you call start by passing a Bundle of options in, or you can use the string representation of the option added to the application meta-data within the AndroidManifest.xml.  Note that all such keys are prefixed with <code>com.swirl</code>.  See below for an example using API_KEY.</p>
<div class="highlight highlight-text-xml"><pre> &lt;<span class="pl-ent">application</span>
     &lt;meta-data <span class="pl-e">android</span><span class="pl-e">:</span><span class="pl-e">name</span>=<span class="pl-s"><span class="pl-pds">"</span>com.swirl.api_key<span class="pl-pds">"</span></span> <span class="pl-e">android</span><span class="pl-e">:</span><span class="pl-e">value</span>=<span class="pl-s"><span class="pl-pds">"</span>YOU-CAN-PUT-YOUR-API-KEY-HERE<span class="pl-pds">"</span></span>/&gt;
     ...</pre></div>
<h4>
<a id="user-content-registering-components" class="anchor" name="registering-components" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Registering Components</h4>
<p>In order for the library to function properly, a number of components need to be registered in the manifest.</p>
<ol>
<li>Swirl uses a service to run in the background.  This services is sticky and runs for a set period of time after being launched in response to some signal from the OS.  This service must be registered.</li>
<li>Several BroadcastReceivers also are employed to receive various inputs from the OS.  These receivers are used to catch Notification events (OPEN, DISMISS), Alarm Events, Location Events, and Device Change events (NETWORK, WIFI, etc).</li>
<li>ContentActivity.  If you are using the ContentManager to schedule targeted content against your signals (geofence, wifi, beacon), and you want want to display interstitial content, then you need to register the ContentActivity which is launched to display the web content.</li>
</ol>
<div class="highlight highlight-text-xml"><pre>&lt;<span class="pl-ent">application</span>
		android:name=<span class="pl-s"><span class="pl-pds">"</span>.BaseApplication<span class="pl-pds">"</span></span>&gt;
		
  &lt;<span class="pl-ent">service</span>  <span class="pl-e">android</span><span class="pl-e">:</span><span class="pl-e">name</span>=<span class="pl-s"><span class="pl-pds">"</span>com.swirl.Swirl$Service<span class="pl-pds">"</span></span>/&gt;
  &lt;<span class="pl-ent">receiver</span> <span class="pl-e">android</span><span class="pl-e">:</span><span class="pl-e">name</span>=<span class="pl-s"><span class="pl-pds">"</span>com.swirl.Swirl$Receiver<span class="pl-pds">"</span></span>        <span class="pl-e">android</span><span class="pl-e">:</span><span class="pl-e">enabled</span>=<span class="pl-s"><span class="pl-pds">"</span>true<span class="pl-pds">"</span></span>/&gt;
  &lt;<span class="pl-ent">receiver</span> <span class="pl-e">android</span><span class="pl-e">:</span><span class="pl-e">name</span>=<span class="pl-s"><span class="pl-pds">"</span>com.swirl.Swirl$LocationChanged<span class="pl-pds">"</span></span> <span class="pl-e">android</span><span class="pl-e">:</span><span class="pl-e">enabled</span>=<span class="pl-s"><span class="pl-pds">"</span>true<span class="pl-pds">"</span></span>/&gt;
  &lt;<span class="pl-ent">receiver</span> <span class="pl-e">android</span><span class="pl-e">:</span><span class="pl-e">name</span>=<span class="pl-s"><span class="pl-pds">"</span>com.swirl.Swirl$DeviceChanged<span class="pl-pds">"</span></span>   <span class="pl-e">android</span><span class="pl-e">:</span><span class="pl-e">enabled</span>=<span class="pl-s"><span class="pl-pds">"</span>true<span class="pl-pds">"</span></span>&gt;
      &lt;<span class="pl-ent">intent-filter</span>&gt;
          &lt;<span class="pl-ent">action</span> <span class="pl-e">android</span><span class="pl-e">:</span><span class="pl-e">name</span>=<span class="pl-s"><span class="pl-pds">"</span>android.intent.action.BOOT_COMPLETED<span class="pl-pds">"</span></span>/&gt;
          &lt;<span class="pl-ent">action</span> <span class="pl-e">android</span><span class="pl-e">:</span><span class="pl-e">name</span>=<span class="pl-s"><span class="pl-pds">"</span>android.net.wifi.STATE_CHANGE<span class="pl-pds">"</span></span>/&gt;
      &lt;/<span class="pl-ent">intent-filter</span>&gt;
  &lt;/<span class="pl-ent">receiver</span>&gt;
  &lt;<span class="pl-ent">activity</span> <span class="pl-e">android</span><span class="pl-e">:</span><span class="pl-e">name</span>=<span class="pl-s"><span class="pl-pds">"</span>com.swirl.ContentActivity<span class="pl-pds">"</span></span>/&gt;</pre></div>
<h3>
<a id="user-content-make-code-changes" class="anchor" name="make-code-changes" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Make Code Changes</h3>
<h4>
<a id="user-content-permission-changes" class="anchor" name="permission-changes" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Permission Changes</h4>
<p>The Swirl SDK requires Location Services, Bluetooth and Local Notifications to be fully effective.  The host application is responsible for managing the opt-in flow and prompting the user for the necessary permissions.  When started, if the proper permissions have not been granted, then functionality will be limited.  To support Android 6.0, ff you do not already, you will need to request dynamic permissions for Location.</p>
<h4>
<a id="user-content-background-launch-changes" class="anchor" name="background-launch-changes" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Background Launch Changes</h4>
<p>Because there are a number of different ways that Swirl can be launched we recommend you subclass the Application and initialize Swirl there.  That way, no matter how the functionality is launched that initialization will be done first and Swirl will be ready and running when it needs to process the event that cause the launch.</p>
<h4>
<a id="user-content-initialize-configure-and-start" class="anchor" name="initialize-configure-and-start" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Initialize, Configure and Start</h4>
<p>A lot of time and effort has been put into making the Swirl SDK as simple as possible without sacrificing functionality or power.  Due to the possibility of background launches caused by LocationManager or AlarmManager or other broadcast Intents that the SDK has registered for, the best place to initialize and start the SDK is early in <code>onCreate</code> in your <code>Application</code> subclass.</p>
<div class="highlight highlight-source-java"><pre><span class="pl-k">public</span> <span class="pl-k">class</span> <span class="pl-en">BaseApplication</span> <span class="pl-k">extends</span> <span class="pl-e">Application</span> {
    <span class="pl-k">@Override</span> <span class="pl-k">public</span> <span class="pl-k">void</span> <span class="pl-en">onCreate</span>() {
        <span class="pl-c1">super</span><span class="pl-k">.</span>onCreate();
        
        <span class="pl-smi">Bundle</span> options <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-smi">Bundle</span>();
        <span class="pl-c"><span class="pl-c">//</span> set any options you want to set at startup (or pass null)</span>

        <span class="pl-smi">Swirl</span><span class="pl-k">.</span>getInstance(<span class="pl-c1">this</span>)<span class="pl-k">.</span>addListener(<span class="pl-k">new</span> <span class="pl-smi">ContentManager</span>(<span class="pl-c1">this</span>));
        <span class="pl-smi">Swirl</span><span class="pl-k">.</span>getInstance()<span class="pl-k">.</span>start(options);
    }
}</pre></div>
<h3>
<a id="user-content-using-nearby-with-swirl" class="anchor" name="using-nearby-with-swirl" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Using Nearby with Swirl</h3>
<p>Swirl supports Nearby in a number of ways.  You can use Swirl to manage the registration of your beacons and attachments with Nearby and you can use the Swirl SDK to detect beacons and their attachments whether they were registered through Swirl's platform or not.  Beacons registered with the Swirl will be available for Swirl's targeted content delivery, but the SDK can detect and return any attachments on the beacon.</p>
<h4>
<a id="user-content-configure-your-project-for-nearby" class="anchor" name="configure-your-project-for-nearby" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Configure your project for Nearby</h4>
<p>Since the NearbyManager uses the Nearby APIs from google, you will need to ensure that you have an API key allocated thorugh the Google API dashboard and specified in your Manifest.xml.</p>
<div class="highlight highlight-text-xml"><pre>		&lt;<span class="pl-ent">meta-data</span>
			android:name=<span class="pl-s"><span class="pl-pds">"</span>com.google.android.nearby.messages.API_KEY<span class="pl-pds">"</span></span>
			android:value=<span class="pl-s"><span class="pl-pds">"</span>YOUR-GOOGLE-NEARBY-API-KEY-GOES-HERE<span class="pl-pds">"</span></span>/&gt;</pre></div>
<h4>
<a id="user-content-initialize-and-start-the-nearbymanager" class="anchor" name="initialize-and-start-the-nearbymanager" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Initialize and start the NearbyManager</h4>
<p>The Swirl SDK can be used with Nearby by adding the NearbyManager to the set of active managers when starting the SDK.  The NearbyManager is not started by default, but can be added folloing the following examples:</p>
<div class="highlight highlight-source-java"><pre>	<span class="pl-c"><span class="pl-c">//</span> add default NearbyManager which scans for all project message types</span>
	<span class="pl-smi">Swirl</span><span class="pl-k">.</span>getInstance()<span class="pl-k">.</span>addListener(<span class="pl-k">new</span> <span class="pl-smi">NearbyManager</span>(<span class="pl-c1">null</span>));
	
	<span class="pl-c"><span class="pl-c">//</span> or, configure a specific type or Eddystone-UID namespace</span>
	<span class="pl-smi">Swirl</span><span class="pl-k">.</span>getInstance()<span class="pl-k">.</span>addListener(<span class="pl-k">new</span> <span class="pl-smi">NearbyManager</span>(<span class="pl-c1">null</span>)
		.addEddystoneNamespace(<span class="pl-s"><span class="pl-pds">"</span><span class="pl-pds">"</span></span>f86410c4c588a9cec5f2<span class="pl-s"><span class="pl-pds">"</span>));</span></pre></div>
<p>Due to a design choice with the Nearby APIs, initiating message scanning (even for BLE only messages) requires an Activity context.  As a result, you must call the <code>setActivity</code> method on the NearbyManager to provide an appropriate context.  Without an appropriate context, Nearby will cease message detection.</p>
<div class="highlight highlight-source-java"><pre>	<span class="pl-c"><span class="pl-c">//</span> be sure to call this whenever the activity changes</span>
	<span class="pl-smi">NearbyManager</span><span class="pl-k">.</span>getInstance()<span class="pl-k">.</span>setActivity(<span class="pl-c1">this</span>);</pre></div>
<h4>
<a id="user-content-getting-beacon-attachments" class="anchor" name="getting-beacon-attachments" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Getting Beacon Attachments</h4>
<p>Nearby has a very flexible system for attaching data to beacons and the SDK will return those attachments when encountered through a callback on the <code>SwirlListener</code>:</p>
<div class="highlight highlight-source-java"><pre>    <span class="pl-c"><span class="pl-c">/*</span>*</span>
<span class="pl-c">     * Call whenever the NearbyManager posts a nearby related message.</span>
<span class="pl-c">     * @param manager The NearbyManager</span>
<span class="pl-c">     * @param namespace The project or public attachment namespace</span>
<span class="pl-c">     * @param type The attachement type</span>
<span class="pl-c">     * @param content The byte array which is the message content</span>
<span class="pl-c">     * @param rssi The signal strength if available, or -1 if not available</span>
<span class="pl-c">     <span class="pl-c">*/</span></span>
    <span class="pl-k">protected</span> <span class="pl-k">void</span> onNearbyMessage(<span class="pl-smi">NearbyManager</span> manager, <span class="pl-smi">String</span> namespace, 
    					<span class="pl-smi">String</span> type, <span class="pl-k">byte</span>[] content, <span class="pl-k">int</span> rssi);</pre></div>
<p>However, it is important to note that some attachments are treated specially by the system and will not be returned through the SDK directly. The following messages are not delivered by <code>onNearbyMessage</code> but are handled as specified.</p>
<table>
<thead>
<tr>
<th>Message-Namespace</th>
<th>Message-Type</th>
<th>Default Action</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>MESSAGE_NAMESPACE_RESERVED</code></td>
<td><code>MESSAGE_TYPE_EDDYSTONE_UID</code></td>
<td>Message content are used to construct an Eddystone-UID <code>BeaconAdvertisement</code> object which is then handled as any other scanned BLE advertisement</td>
</tr>
<tr>
<td><strong>project-name</strong></td>
<td><code>swirl</code></td>
<td>Message contents are used to construct a <code>BeaconAdvertisement</code> object which is then handled appropriately by the system</td>
</tr>
</tbody>
</table>
<h4>
<a id="user-content-try-our-example" class="anchor" name="try-our-example" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Try our example</h4>
<p>The Swirlx example has all of the code you need to try the Nearby API integration ready to go.  All you need to do is search for Nearby in the <code>BaseApplication</code> and <code>MainActivity</code> java source and uncomment the lines that are commented out.  In addition, you should add the relevant API keys in the <code>AndroidManifest.xml</code> file.</p>
<!-- END-CONTENT -->
						</article>
					</div>
				</div>
			</div>
		</div>
	</body>
</html>
